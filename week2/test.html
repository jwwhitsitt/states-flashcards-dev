<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Week 2 – Check Your Learning</title>

  <style>
    :root{
      --bg:#f4f6fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --shadow:0 10px 30px rgba(15,23,42,.12);
      --radius:18px;
      --link:#1d4ed8;
      --btn:#0f172a;
      --btn2:#e5e7eb;
      --btn2text:#111827;
      --bar:#c7d2fe;
      --barbg:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      height:100vh;
      display:flex;
      flex-direction:column;
      overflow:hidden; /* enforce no page scroll */
    }

    header{
      flex:0 0 auto;
      padding:10px 14px;
      background:#fff;
      box-shadow:0 1px 10px rgba(0,0,0,.06);
      display:flex;
      align-items:center;
      gap:10px;
    }
    header a{
      text-decoration:none;
      color:var(--link);
      font-weight:900;
      white-space:nowrap;
    }
    header h1{
      margin:0;
      font-size:16px;
      font-weight:1000;
      text-align:center;
      flex:1;
    }
    header .spacer{ width:52px; }

    main{
      flex:1 1 auto;
      min-height:0;
      display:flex;
      justify-content:center;
      align-items:stretch;
      padding:10px 12px 12px;
      overflow:hidden;
    }

    .wrap{
      width:100%;
      max-width:720px;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    /* ===== Top progress row (tightened) ===== */
    .toprow{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .pill{
      background:#dbeafe;
      color:#1e3a8a;
      font-weight:1000;
      border-radius:999px;
      padding:7px 10px;
      font-size:13px;
      min-width:88px;
      text-align:center;
      white-space:nowrap;
    }
    .barwrap{
      flex:1;
      height:16px;
      background:var(--barbg);
      border-radius:999px;
      position:relative;
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
    }
    .bar{
      height:100%;
      width:0%;
      background:var(--bar);
      border-radius:999px;
      transition:width .25s ease;
    }
    .bartext{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      color:#111827;
      font-size:13px;
      text-shadow:0 1px 0 rgba(255,255,255,.75);
      pointer-events:none;
    }

    /* ===== Main card (no scroll) ===== */
    .card{
      flex:1 1 auto;
      min-height:0;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:hidden; /* keep everything on screen */
    }

    .imgbox{
      flex:0 0 auto;
      border-radius:16px;
      background:#fff;
      display:none;
      align-items:center;
      justify-content:center;
      padding:8px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
      height:160px; /* smaller to avoid scroll */
      overflow:hidden;
    }
    .imgbox.show{ display:flex; }
    .imgbox img{
      width:100%;
      height:100%;
      object-fit:contain;
      border-radius:12px;
    }

    .qtitle{
      flex:0 0 auto;
      font-size:26px;          /* reduced */
      font-weight:1000;
      line-height:1.05;
      margin-top:2px;
    }
    .qsub{
      flex:0 0 auto;
      color:var(--muted);
      font-weight:800;
      margin:0;
      font-size:14px;
    }

    .answers{
      flex:1 1 auto;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:8px;               /* reduced */
      overflow:hidden;       /* no scrolling */
      justify-content:flex-start;
    }
    .choice{
      flex:0 0 auto;
      border-radius:14px;
      border:2px solid #e5e7eb;
      background:#fff;
      padding:10px 12px;     /* reduced height */
      font-size:18px;        /* reduced */
      font-weight:1000;
      text-align:left;
      cursor:pointer;
      line-height:1.15;
      transition:transform .05s ease, border-color .1s ease, background .1s ease;
    }
    .choice:active{ transform:scale(.995); }
    .choice.correct{
      border-color:#22c55e;
      background:#ecfdf5;
    }
    .choice.wrong{
      border-color:#ef4444;
      background:#fef2f2;
    }

    .bottom{
      flex:0 0 auto;
      display:flex;
      gap:10px;
      margin-top:2px;
    }
    .btn{
      flex:1;
      padding:10px 12px;     /* reduced */
      border-radius:14px;
      border:0;
      font-size:15px;        /* reduced */
      font-weight:1000;
      cursor:pointer;
      background:var(--btn);
      color:#fff;
      box-shadow:0 10px 20px rgba(0,0,0,.10);
    }
    .btn.secondary{
      background:var(--btn2);
      color:var(--btn2text);
      box-shadow:none;
    }
    .btn:disabled{
      opacity:.45;
      cursor:not-allowed;
      box-shadow:none;
    }

    .result{
      flex:0 0 auto;
      text-align:center;
      font-weight:1000;
      color:var(--muted);
      font-size:13px;
      margin-top:2px;
      min-height:18px;
    }

    .review{
      margin-top:6px;
      padding:10px;
      border-radius:14px;
      background:#f8fafc;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
      overflow:auto;           /* internal scroll if list is long (page still won’t scroll) */
      max-height:170px;
    }
    .review h2{
      margin:0 0 6px 0;
      font-size:15px;
      font-weight:1000;
    }
    .review ul{
      margin:0;
      padding-left:18px;
      color:#111827;
      font-weight:800;
      font-size:14px;
    }
    .small{
      font-size:12.5px;
      color:var(--muted);
      font-weight:800;
      margin-top:6px;
    }

    /* Extra safety for short screens */
    @media (max-height: 700px){
      .imgbox{ height:140px; }
      .qtitle{ font-size:24px; }
      .choice{ padding:9px 12px; font-size:17px; }
      .btn{ padding:9px 12px; }
      .answers{ gap:7px; }
    }
  </style>
</head>

<body>
  <header>
    <a href="./index.html">← Back</a>
    <h1>Check Your Learning</h1>
    <div class="spacer"></div>
  </header>

  <main>
    <div class="wrap">

      <div class="toprow">
        <div class="pill" id="sectionPill">Spelling</div>
        <div class="barwrap" aria-label="Progress">
          <div class="bar" id="bar"></div>
          <div class="bartext" id="barText">1 of 12</div>
        </div>
      </div>

      <section class="card" id="card">
        <div class="imgbox" id="imgbox"><img id="img" alt="" /></div>

        <div class="qtitle" id="qtitle">Pick the correct spelling</div>
        <div class="qsub" id="qsub">Tap one answer.</div>

        <div class="answers" id="answers"></div>

        <div class="bottom">
          <button class="btn secondary" id="exitBtn">Exit</button>
          <button class="btn" id="nextBtn" disabled>Next</button>
        </div>

        <div class="result" id="result"></div>
        <div id="reviewBox" style="display:none;"></div>
      </section>
    </div>
  </main>

  <script>
    // ====== Data ======
    const WEEK = [
      { state:"Pennsylvania", abbrev:"PA", capital:"Harrisburg", img:"./images/pa-f.png" },
      { state:"New Jersey",   abbrev:"NJ", capital:"Trenton",    img:"./images/nj-f.png" },
      { state:"New York",     abbrev:"NY", capital:"Albany",     img:"./images/ny-f.png" },
      { state:"Delaware",     abbrev:"DE", capital:"Dover",      img:"./images/de-f.png" }
    ];

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    // spelling fake options (all are attempts at the SAME word)
    const SPELLING_FAKES = {
      "Pennsylvania":["Pencilvainya","Pensylvainia","Penzylvania","Pennsylvainia","Pensylvania"],
      "New Jersey":["New Jerzee","New Jersy","Nu Jersey","New Jersie","New Jerzy"],
      "New York":["New Yorc","Nu York","New Yark","New Yorck","New Yorrk"],
      "Delaware":["Della-ware","Delawair","Delawere","Delawar","Delawairre"]
    };

    // If we ever don’t have enough fakes for a word, generate a couple simple variants.
    function generateFallbackFakes(word){
      const w = word;
      const s = w.replace(/\s+/g,"");
      const variants = new Set();

      // basic “kid-misspell” style transforms
      variants.add(w.replace(/nn/g,"n"));
      variants.add(w.replace(/ie/g,"ei"));
      variants.add(w.replace(/y/g,"i"));
      variants.add(w.replace(/a/g,"e"));
      variants.add(w.replace(/e/g,"a"));

      // small swap near middle if possible
      if(s.length >= 6){
        const i = Math.floor(s.length/2);
        const arr = s.split("");
        [arr[i], arr[i+1]] = [arr[i+1], arr[i]];
        variants.add(arr.join(""));
      }

      // convert back to spaced if original had spaces (New York etc.)
      const out = [];
      for(const v of variants){
        if(v && v !== word) out.push(v);
      }
      return out.slice(0,6);
    }

    function buildSpellingChoices(correct){
      const base = (SPELLING_FAKES[correct] || []).slice();
      const fallback = generateFallbackFakes(correct);
      const pool = shuffle([...base, ...fallback]).filter(x => x && x !== correct);

      // Need exactly 3 fakes + correct = 4 total
      const fakes = [];
      for(const item of pool){
        if(fakes.length >= 3) break;
        if(!fakes.includes(item)) fakes.push(item);
      }

      // absolute safety: if still short, pad with repeated-ish variants
      while(fakes.length < 3){
        fakes.push(correct + " "); // visually different, still an “attempt”
      }

      return shuffle([correct, ...fakes]);
    }

    // ====== Build 3-part test (12 questions: 4+4+4) ======

    // Part 1: Spelling (shows image; does NOT reveal the correct state name as a header)
    const spellingQuestions = WEEK.map(s => {
      const correct = s.state;
      return {
        section:"Spelling",
        showImage:true,
        img:s.img,
        title:"Pick the correct spelling",
        subtitle:"Which one is spelled correctly?",
        correct,
        choices: buildSpellingChoices(correct)
      };
    });

    // Part 2: Capitals (NO image — don’t give the answer away)
    const capitalQuestions = WEEK.map(s => {
      const correct = s.state;
      const wrongs = WEEK.map(x => x.state).filter(x => x !== correct);
      const choices = shuffle([correct, ...wrongs]); // stays within this week set (4 choices total)
      return {
        section:"Capitals",
        showImage:false,
        img:null,
        title:s.capital,
        subtitle:"Which state has this capital?",
        correct,
        choices
      };
    });

    // Part 3: Abbreviations (NO image)
    const abbrevQuestions = WEEK.map(s => {
      const correct = s.abbrev;
      const wrongs = WEEK.map(x => x.abbrev).filter(x => x !== correct);
      const choices = shuffle([correct, ...wrongs]); // stays within this week set (4 choices total)
      return {
        section:"Abbreviations",
        showImage:false,
        img:null,
        title:s.state,
        subtitle:"Which abbreviation matches this state?",
        correct,
        choices
      };
    });

    const QUESTIONS = [...spellingQuestions, ...capitalQuestions, ...abbrevQuestions];

    // ====== UI hooks ======
    const sectionPill = document.getElementById("sectionPill");
    const bar = document.getElementById("bar");
    const barText = document.getElementById("barText");

    const imgbox = document.getElementById("imgbox");
    const img = document.getElementById("img");
    const qtitle = document.getElementById("qtitle");
    const qsub = document.getElementById("qsub");
    const answersEl = document.getElementById("answers");
    const resultEl = document.getElementById("result");
    const reviewBox = document.getElementById("reviewBox");

    const exitBtn = document.getElementById("exitBtn");
    const nextBtn = document.getElementById("nextBtn");

    let idx = 0;
    let locked = false;

    const results = []; // {question, chosen, correct}
    const missed = new Set();

    function setProgress(){
      const n = QUESTIONS.length;
      const pos = idx + 1;
      const pct = Math.round((pos / n) * 100);
      bar.style.width = pct + "%";
      barText.textContent = `${pos} of ${n}`;
      sectionPill.textContent = QUESTIONS[idx].section;
    }

    function renderQuestion(){
      locked = false;
      nextBtn.disabled = true;
      resultEl.textContent = "";
      reviewBox.style.display = "none";
      reviewBox.innerHTML = "";

      const q = QUESTIONS[idx];
      setProgress();

      // image rules
      if(q.showImage && q.img){
        imgbox.classList.add("show");
        img.src = q.img;
        img.alt = "State flashcard";
      } else {
        imgbox.classList.remove("show");
        img.src = "";
        img.alt = "";
      }

      qtitle.textContent = q.title;
      qsub.textContent = q.subtitle;

      answersEl.innerHTML = "";
      q.choices.forEach(choice => {
        const b = document.createElement("button");
        b.className = "choice";
        b.type = "button";
        b.textContent = choice.trimEnd();
        b.addEventListener("click", () => chooseAnswer(choice.trimEnd()));
        answersEl.appendChild(b);
      });

      nextBtn.textContent = (idx === QUESTIONS.length - 1) ? "Finish" : "Next";
    }

    function chooseAnswer(choice){
      if(locked) return;
      locked = true;

      const q = QUESTIONS[idx];
      const isCorrect = (choice === q.correct);

      // mark buttons
      const btns = Array.from(document.querySelectorAll(".choice"));
      btns.forEach(b => {
        const txt = b.textContent;
        if(txt === q.correct) b.classList.add("correct");
        else if(txt === choice) b.classList.add("wrong");
        b.disabled = true;
      });

      if(isCorrect){
        resultEl.textContent = "✅ Nice!";
      } else {
        resultEl.textContent = "❌ Almost — keep going.";
        missed.add(`${q.section}: ${q.title}`);
      }

      results.push({ q, chosen: choice, correct: q.correct });
      nextBtn.disabled = false;
    }

    function showSummary(){
      const total = results.length;
      const correct = results.filter(r => r.chosen === r.correct).length;
      const pct = Math.round((correct / total) * 100);

      imgbox.classList.remove("show");
      answersEl.innerHTML = "";
      qtitle.textContent = `Score: ${pct}%`;
      qsub.textContent = `You got ${correct} out of ${total} correct.`;

      const misses = Array.from(missed);
      const reviewHtml = `
        <div class="review">
          <h2>${misses.length ? "Review these:" : "Nothing to review — nice work!"}</h2>
          ${misses.length ? `<ul>${misses.map(m => `<li>${m}</li>`).join("")}</ul>` : ""}
          <div class="small">Tip: Study again, then try the test one more time.</div>
        </div>
      `;
      reviewBox.style.display = "block";
      reviewBox.innerHTML = reviewHtml;

      exitBtn.textContent = "Back to Week 2";
      nextBtn.style.display = "none";

      bar.style.width = "100%";
      barText.textContent = `${total} of ${total}`;
      sectionPill.textContent = "Done";
    }

    nextBtn.addEventListener("click", () => {
      if(idx === QUESTIONS.length - 1){
        showSummary();
        return;
      }
      idx++;
      renderQuestion();
    });

    exitBtn.addEventListener("click", () => {
      window.location.href = "./index.html";
    });

    renderQuestion();
  </script>
</body>
</html>
