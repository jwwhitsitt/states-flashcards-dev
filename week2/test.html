<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Week 2 ‚Äì Check Your Learning</title>

  <style>
    :root{
      --bg:#f4f6fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --shadow:0 10px 30px rgba(15,23,42,.12);
      --radius:18px;
      --link:#1d4ed8;

      --btn:#0f172a;
      --btn2:#e5e7eb;
      --btn2text:#111827;

      --bar:#c7d2fe;
      --barbg:#e5e7eb;

      --ok:#22c55e;
      --bad:#ef4444;

      /* default answer-slot sizing (will be overridden dynamically) */
      --slotW:30px;
      --slotH:38px;
      --slotGap:8px;
      --slotFont:18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      height:100vh;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    header{
      padding:10px 14px;
      background:#fff;
      box-shadow:0 1px 10px rgba(0,0,0,.06);
      display:flex;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
    }
    header a{
      text-decoration:none;
      color:var(--link);
      font-weight:900;
      white-space:nowrap;
    }
    header h1{
      margin:0;
      font-size:16px;
      font-weight:1000;
      text-align:center;
      flex:1;
    }
    header .spacer{ width:52px; }

    main{
      flex:1 1 auto;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:12px;
      overflow:hidden;
      min-height:0;
    }
    .wrap{
      width:100%;
      max-width:720px;
      min-height:0;
    }

    .toprow{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:10px;
    }
    .pill{
      background:#dbeafe;
      color:#1e3a8a;
      font-weight:1000;
      border-radius:999px;
      padding:8px 12px;
      font-size:14px;
      min-width:92px;
      text-align:center;
      white-space:nowrap;
    }
    .barwrap{
      flex:1;
      height:18px;
      background:var(--barbg);
      border-radius:999px;
      position:relative;
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
    }
    .bar{
      height:100%;
      width:0%;
      background:var(--bar);
      border-radius:999px;
      transition:width .25s ease;
    }
    .bartext{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      color:#111827;
      font-size:14px;
      text-shadow:0 1px 0 rgba(255,255,255,.75);
      pointer-events:none;
    }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      height:calc(100vh - 52px - 24px - 28px);
      max-height:780px;
      overflow:hidden;
      min-height:0;
    }

    .imgbox{
      border-radius:16px;
      background:#fff;
      display:none;
      align-items:center;
      justify-content:center;
      padding:10px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
      height:190px;
      overflow:hidden;
      flex:0 0 auto;
    }
    .imgbox.show{ display:flex; }
    .imgbox img{
      width:100%;
      height:100%;
      object-fit:contain;
      border-radius:12px;
    }

    .qtitle{
      font-size:28px;
      font-weight:1000;
      line-height:1.05;
      margin-top:2px;
      flex:0 0 auto;
    }
    .qsub{
      color:var(--muted);
      font-weight:800;
      margin-bottom:2px;
      flex:0 0 auto;
    }

    /* MC answers */
    .answers{
      display:flex;
      flex-direction:column;
      gap:10px;
      flex:1 1 auto;
      min-height:0;
      overflow:hidden;
      justify-content:flex-start;
    }
    .choice{
      border-radius:16px;
      border:2px solid #e5e7eb;
      background:#fff;
      padding:12px 14px;
      font-size:19px;
      font-weight:1000;
      text-align:left;
      cursor:pointer;
      transition:transform .05s ease, border-color .1s ease, background .1s ease;
    }
    .choice:active{ transform:scale(.995); }
    .choice.correct{
      border-color:var(--ok);
      background:#ecfdf5;
    }
    .choice.wrong{
      border-color:var(--bad);
      background:#fef2f2;
    }
    .choice:disabled{
      opacity:1;
      color:inherit;
      -webkit-text-fill-color: inherit;
      cursor:default;
    }

    /* tiles mode */
    .tilesArea{
      display:none;
      flex-direction:column;
      gap:10px;
      flex:1 1 auto;
      min-height:0;
      overflow:hidden;
    }
    .tilesArea.show{ display:flex; }

    .slotsWrap{
      background:#fff;
      border-radius:16px;
      padding:12px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
      display:flex;
      justify-content:center;
      align-items:center;
      flex:0 0 auto;
      min-height:74px;
      overflow:hidden; /* keep clean (no scroll) */
    }
    .slots{
      display:flex;
      flex-wrap:nowrap;
      gap:var(--slotGap);
      align-items:center;
      justify-content:center;
      width:100%;
      overflow:hidden; /* safe now because we auto-shrink */
    }
    .slot{
      width:var(--slotW);
      height:var(--slotH);
      border-radius:12px;
      border:2px dashed rgba(15,23,42,.25);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      font-size:var(--slotFont);
      color:#0f172a;
      background:transparent;
      flex:0 0 auto;
      user-select:none;
      text-transform:uppercase;
    }
    .slot.space{
      width:calc(var(--slotW) * 0.55);
      height:10px;
      border:none;
      background:transparent;
    }
    .slotsWrap.ok{
      box-shadow: inset 0 0 0 2px var(--ok);
      background:#ecfdf5;
    }
    .slotsWrap.bad{
      box-shadow: inset 0 0 0 2px var(--bad);
      background:#fef2f2;
    }

    .pool{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      align-content:flex-start;
      flex:1 1 auto;
      overflow:hidden;
      padding:4px 2px;
      min-height:0;
    }
    .tilebtn{
      width:60px;
      height:58px;
      border-radius:16px;
      border:2px solid #e5e7eb;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      font-size:22px;
      cursor:pointer;
      user-select:none;
      transition:transform .05s ease, opacity .12s ease, border-color .12s ease;
      -webkit-tap-highlight-color: transparent;
      text-transform:uppercase;
    }
    .tilebtn:active{ transform:scale(.985); }
    .tilebtn.used{
      opacity:.35;
      cursor:default;
    }
    .tilebtn:disabled{
      pointer-events:none;
    }

    .bottom{
      display:flex;
      gap:10px;
      margin-top:2px;
      flex:0 0 auto;
    }
    .btn{
      flex:1;
      padding:14px 14px;
      border-radius:14px;
      border:0;
      font-size:16px;
      font-weight:1000;
      cursor:pointer;
      background:var(--btn);
      color:#fff;
      box-shadow:0 10px 20px rgba(0,0,0,.10);
    }
    .btn.secondary{
      background:var(--btn2);
      color:var(--btn2text);
      box-shadow:none;
    }
    .btn:disabled{
      opacity:.45;
      cursor:not-allowed;
      box-shadow:none;
    }

    .result{
      text-align:center;
      font-weight:1000;
      color:var(--muted);
      font-size:14px;
      margin-top:4px;
      flex:0 0 auto;
      min-height:18px;
    }
    .advancing{
      text-align:center;
      font-weight:1000;
      color:var(--muted);
      font-size:13px;
      margin-top:-4px;
      display:none;
    }
    .advancing.show{ display:block; }

    .review{
      margin-top:6px;
      padding:12px;
      border-radius:16px;
      background:#f8fafc;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
      overflow:auto;
      max-height:220px;
    }
    .review h2{
      margin:0 0 6px 0;
      font-size:16px;
      font-weight:1000;
    }
    .review ul{
      margin:0;
      padding-left:18px;
      color:#111827;
      font-weight:800;
    }
    .small{
      font-size:13px;
      color:var(--muted);
      font-weight:800;
      margin-top:6px;
    }
  </style>
</head>

<body>
  <header>
    <a href="./index.html">‚Üê Back</a>
    <h1>Check Your Learning</h1>
    <div class="spacer"></div>
  </header>

  <main>
    <div class="wrap">

      <div class="toprow">
        <div class="pill" id="sectionPill">Spelling</div>
        <div class="barwrap" aria-label="Progress">
          <div class="bar" id="bar"></div>
          <div class="bartext" id="barText">1 of 12</div>
        </div>
      </div>

      <section class="card" id="card">
        <div class="imgbox" id="imgbox"><img id="img" alt="" /></div>

        <div class="qtitle" id="qtitle"></div>
        <div class="qsub" id="qsub"></div>

        <div class="answers" id="answers"></div>

        <div class="tilesArea" id="tilesArea">
          <div class="slotsWrap" id="slotsWrap">
            <div class="slots" id="slots"></div>
          </div>
          <div class="pool" id="pool"></div>
        </div>

        <div class="bottom" id="bottomRow">
          <button class="btn secondary" id="exitBtn">Exit</button>
          <button class="btn secondary" id="clearBtn" style="display:none;">Clear</button>
          <button class="btn" id="checkBtn" style="display:none;">Check</button>
        </div>

        <div class="advancing" id="advancing">‚Ä¶</div>
        <div class="result" id="result"></div>
        <div id="reviewBox" style="display:none;"></div>
      </section>
    </div>
  </main>

  <script>
    // ===== Data =====
    const WEEK = [
      { state:"Pennsylvania", abbrev:"PA", capital:"Harrisburg", img:"./images/pa-f.png" },
      { state:"New Jersey",   abbrev:"NJ", capital:"Trenton",    img:"./images/nj-f.png" },
      { state:"New York",     abbrev:"NY", capital:"Albany",     img:"./images/ny-f.png" },
      { state:"Delaware",     abbrev:"DE", capital:"Dover",      img:"./images/de-f.png" }
    ];

    const ALL_ABBREVS = ["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD",
                         "MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC",
                         "SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"];

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }
    function pickDistinct(pool, count, excludeSet){
      const out = [];
      const p = shuffle(pool).filter(x => !excludeSet.has(x));
      for(const item of p){
        if(out.length>=count) break;
        out.push(item);
      }
      return out;
    }

    const SPELLING_FAKES = {
      "Pennsylvania":["Pencilvainya","Pensylvainia","Pennsilvanya","Penzylvania","Pennsylvaina"],
      "New Jersey":["New Jerzee","New Jersy","New Jersei","New Jersie","New Jersiey"],
      "New York":["New Yorc","New Yark","Nu York","New Yoork","New Yorrk"],
      "Delaware":["Delawere","Delawair","Della-ware","Delawar","Delawarre"]
    };

    // ===== Build questions =====
    const spellingQuestions = WEEK.map(s => {
      const correct = s.state;
      const fakes = shuffle(SPELLING_FAKES[correct] || []).slice(0,3);
      let choices = shuffle([correct, ...fakes]).slice(0,4);
      if(!choices.includes(correct)){
        choices[Math.floor(Math.random()*choices.length)] = correct;
      }
      return {
        type:"mc",
        section:"Spelling",
        showImage:true,
        img:s.img,
        title:"Pick the correct spelling",
        subtitle:"Which one is spelled correctly?",
        correct,
        choices,
        reviewKey:`Spelling: ${correct}`
      };
    });

    const capitalsQuestions = WEEK.map(s => ({
      type:"tiles",
      section:"Capitals",
      showImage:false,
      img:null,
      title:s.capital,
      subtitle:"Tap the letters to spell the state.",
      correct:s.state,
      reviewKey:`Capitals: ${s.capital}`
    }));

    const abbrevQuestions = WEEK.map(s => {
      const correct = s.abbrev;
      const wrongs = pickDistinct(ALL_ABBREVS, 3, new Set([correct]));
      const choices = shuffle([correct, ...wrongs]);
      return {
        type:"mc",
        section:"Abbreviations",
        showImage:false,
        img:null,
        title:s.state,
        subtitle:"Which abbreviation matches this state?",
        correct,
        choices,
        reviewKey:`Abbreviations: ${s.state}`
      };
    });

    const QUESTIONS = [...spellingQuestions, ...capitalsQuestions, ...abbrevQuestions];

    // ===== UI hooks =====
    const sectionPill = document.getElementById("sectionPill");
    const bar = document.getElementById("bar");
    const barText = document.getElementById("barText");

    const imgbox = document.getElementById("imgbox");
    const img = document.getElementById("img");
    const qtitle = document.getElementById("qtitle");
    const qsub = document.getElementById("qsub");
    const answersEl = document.getElementById("answers");
    const resultEl = document.getElementById("result");
    const reviewBox = document.getElementById("reviewBox");
    const advancingEl = document.getElementById("advancing");

    const tilesArea = document.getElementById("tilesArea");
    const slotsWrap = document.getElementById("slotsWrap");
    const slotsEl = document.getElementById("slots");
    const poolEl = document.getElementById("pool");

    const exitBtn = document.getElementById("exitBtn");
    const clearBtn = document.getElementById("clearBtn");
    const checkBtn = document.getElementById("checkBtn");

    // ===== state =====
    let idx = 0;
    let locked = false;
    const missed = new Set();

    // tiles state
    let slotChars = [];
    let filled = [];
    let tiles = [];
    let correctUpper = "";

    const MC_ADVANCE_MS = 500;
    const TILES_ADVANCE_MS = 650;

    function setProgress(){
      const n = QUESTIONS.length;
      const pos = Math.min(idx + 1, n);
      const pct = Math.round((pos / n) * 100);
      bar.style.width = pct + "%";
      barText.textContent = `${pos} of ${n}`;
      sectionPill.textContent = QUESTIONS[idx]?.section || "Done";
    }

    function showImageIfNeeded(q){
      if(q.showImage && q.img){
        imgbox.classList.add("show");
        img.src = q.img;
        img.alt = "Flashcard";
      } else {
        imgbox.classList.remove("show");
        img.src = "";
        img.alt = "";
      }
    }

    function setModeMC(){
      answersEl.style.display = "flex";
      tilesArea.classList.remove("show");
      clearBtn.style.display = "none";
      checkBtn.style.display = "none";
    }

    function setModeTiles(){
      answersEl.style.display = "none";
      tilesArea.classList.add("show");
      clearBtn.style.display = "inline-block";
      checkBtn.style.display = "inline-block";
    }

    function autoAdvance(delayMs){
      advancingEl.classList.add("show");
      window.setTimeout(() => {
        advancingEl.classList.remove("show");
        if(idx >= QUESTIONS.length - 1){
          showSummary();
        } else {
          idx++;
          renderQuestion();
        }
      }, delayMs);
    }

    // ===== MC =====
    function renderMC(q){
      setModeMC();
      answersEl.innerHTML = "";
      q.choices.forEach(choice => {
        const b = document.createElement("button");
        b.className = "choice";
        b.type = "button";
        b.textContent = choice;
        b.addEventListener("click", () => chooseMC(choice, q));
        answersEl.appendChild(b);
      });
    }

    function chooseMC(choice, q){
      if(locked) return;
      locked = true;

      const btns = Array.from(document.querySelectorAll(".choice"));
      btns.forEach(b => {
        b.disabled = true;
        if(b.textContent === q.correct) b.classList.add("correct");
        else if(b.textContent === choice) b.classList.add("wrong");
      });

      const isCorrect = (choice === q.correct);
      resultEl.textContent = isCorrect ? "‚úÖ Nice!" : "‚ùå Almost ‚Äî keep going.";
      if(!isCorrect) missed.add(q.reviewKey);

      autoAdvance(MC_ADVANCE_MS);
    }

    // ===== Tiles (CAPS + auto-fit slots) =====
    function setSlotSizingForWord(targetUpper){
      // count letters excluding spaces
      const lettersCount = targetUpper.replace(/ /g,"").length;

      // defaults (short words)
      let slotW = 30, slotH = 38, gap = 8, font = 18;

      // tune for longer one-word states
      // (Pennsylvania=12, Mississippi=11, Massachusetts=13, etc.)
      if(lettersCount >= 11){
        slotW = 24; slotH = 34; gap = 6; font = 15;
      }
      if(lettersCount >= 13){
        slotW = 21; slotH = 32; gap = 5; font = 14;
      }
      if(lettersCount >= 15){
        slotW = 19; slotH = 30; gap = 4; font = 13;
      }

      // apply to CSS variables on the card so it affects only this page
      document.documentElement.style.setProperty("--slotW", slotW + "px");
      document.documentElement.style.setProperty("--slotH", slotH + "px");
      document.documentElement.style.setProperty("--slotGap", gap + "px");
      document.documentElement.style.setProperty("--slotFont", font + "px");
    }

    function buildTilesTarget(word){
      correctUpper = word.toUpperCase();
      setSlotSizingForWord(correctUpper);

      slotChars = Array.from(correctUpper); // includes spaces
      filled = slotChars.map(ch => ch === " " ? " " : null);

      const letters = slotChars.filter(ch => ch !== " ");
      tiles = shuffle(letters).map((ch, i) => ({ idx:i, ch, used:false }));
    }

    function renderSlots(){
      slotsEl.innerHTML = "";
      slotChars.forEach((ch, i) => {
        if(ch === " "){
          const sp = document.createElement("div");
          sp.className = "slot space";
          slotsEl.appendChild(sp);
          return;
        }
        const d = document.createElement("div");
        d.className = "slot";
        d.textContent = filled[i] ? filled[i] : "";
        slotsEl.appendChild(d);
      });
    }

    function renderPool(){
      poolEl.innerHTML = "";
      tiles.forEach((t, poolIndex) => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "tilebtn" + (t.used ? " used" : "");
        b.textContent = t.ch;               // already CAPS
        b.disabled = t.used || locked;

        b.addEventListener("click", () => {
          if(locked) return;
          placeTile(poolIndex);
        });

        poolEl.appendChild(b);
      });
    }

    function firstEmptyIndex(){
      for(let i=0;i<filled.length;i++){
        if(slotChars[i] === " ") continue;
        if(filled[i] === null) return i;
      }
      return -1;
    }

    function placeTile(poolIndex){
      const i = firstEmptyIndex();
      if(i === -1) return;

      const t = tiles[poolIndex];
      if(!t || t.used) return;

      filled[i] = t.ch;
      t.used = true;

      renderSlots();
      renderPool();
    }

    function clearTiles(){
      if(locked) return;
      filled = slotChars.map(ch => ch === " " ? " " : null);
      tiles.forEach(t => t.used = false);
      slotsWrap.classList.remove("ok","bad");
      resultEl.textContent = "";
      renderSlots();
      renderPool();
    }

    function currentAnswer(){
      let out = "";
      for(let i=0;i<slotChars.length;i++){
        if(slotChars[i] === " ") out += " ";
        else out += (filled[i] || "");
      }
      return out;
    }

    function allFilled(){
      return firstEmptyIndex() === -1;
    }

    function checkTiles(q){
      if(locked) return;

      if(!allFilled()){
        resultEl.textContent = "Fill all the spaces first üôÇ";
        return;
      }

      locked = true;

      const guess = currentAnswer().toUpperCase();
      const isCorrect = (guess === correctUpper);

      slotsWrap.classList.remove("ok","bad");
      slotsWrap.classList.add(isCorrect ? "ok" : "bad");

      if(isCorrect){
        resultEl.textContent = "‚úÖ Nice!";
      } else {
        resultEl.textContent = `‚ùå Almost ‚Äî it was ${correctUpper}.`;
        missed.add(q.reviewKey);
      }

      renderPool();
      autoAdvance(TILES_ADVANCE_MS);
    }

    // ===== Render =====
    function renderQuestion(){
      locked = false;
      resultEl.textContent = "";
      advancingEl.classList.remove("show");
      reviewBox.style.display = "none";
      reviewBox.innerHTML = "";
      slotsWrap.classList.remove("ok","bad");

      const q = QUESTIONS[idx];
      setProgress();
      showImageIfNeeded(q);

      qtitle.textContent = q.title;
      qsub.textContent = q.subtitle;

      if(q.type === "mc"){
        renderMC(q);
      } else {
        setModeTiles();
        buildTilesTarget(q.correct);
        renderSlots();
        renderPool();
      }
    }

    function showSummary(){
      sectionPill.textContent = "Done";
      bar.style.width = "100%";
      barText.textContent = `${QUESTIONS.length} of ${QUESTIONS.length}`;

      imgbox.classList.remove("show");
      answersEl.style.display = "none";
      tilesArea.classList.remove("show");
      clearBtn.style.display = "none";
      checkBtn.style.display = "none";

      const total = QUESTIONS.length;
      const missedCount = missed.size;
      const correct = total - missedCount;
      const pct = Math.round((correct / total) * 100);

      qtitle.textContent = `Score: ${pct}%`;
      qsub.textContent = `You got ${correct} out of ${total} correct.`;

      let tipLine = "";
      if(pct === 100){
        tipLine = "Perfect score! üéâ Nice work ‚Äî do a quick review tomorrow to lock it in.";
      } else if(pct >= 80){
        tipLine = "Nice work! Review the ones below, then you‚Äôll crush it next time.";
      } else {
        tipLine = "Good effort. Review these, then try again after a quick study session.";
      }

      const misses = Array.from(missed);
      const reviewHtml = `
        <div class="review">
          <h2>${misses.length ? "Review these:" : "Nothing to review ‚Äî nice work!"}</h2>
          ${misses.length ? `<ul>${misses.map(m => `<li>${m}</li>`).join("")}</ul>` : ""}
          <div class="small">${tipLine}</div>
        </div>
      `;
      reviewBox.style.display = "block";
      reviewBox.innerHTML = reviewHtml;

      exitBtn.textContent = "Back to Week 2";
      resultEl.textContent = (pct === 100) ? "‚úÖ Awesome!" : "‚úÖ Nice!";
    }

    // ===== Events =====
    exitBtn.addEventListener("click", () => {
      window.location.href = "./index.html";
    });

    clearBtn.addEventListener("click", clearTiles);
    checkBtn.addEventListener("click", () => checkTiles(QUESTIONS[idx]));

    renderQuestion();
  </script>
</body>
</html>